---
title: "Community data analysis using the vegan package in R"
author: "Naupaka Zimmerman and Gavin Simpson"
date: "August 9, 2014 • ESA 2014"
output:
  ioslides_presentation:
    fig_height: 6
    fig_width: 7
    highlight: tango
    keep_md: yes
    widescreen: yes
bibliography: intro-basics.bib
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(comment = "", cache = TRUE)
```

<!----------------------------slide boundary--------------------------------->
## Workshop logistics

* Etherpad 
    * https://etherpad.mozilla.org/ESA2014-vegan

<!----------------------------slide boundary--------------------------------->
## Workshop logistics

* Etherpad 
    * https://etherpad.mozilla.org/ESA2014-vegan
* Red and Green Stickies 
  
![](img/Green_post_it.png)&nbsp;&nbsp;&nbsp;&nbsp;![](img/Red_post_it.png)

<!----------------------------slide boundary--------------------------------->
## Packages installed?

```{r, eval=FALSE}
install.packages("vegan", dependencies = TRUE)
install.packages("plyr")
install.packages("reshape2")
```

<!----------------------------slide boundary--------------------------------->
## Introduction to **vegan**

* What is it?
* Who developed it?
* How does it differ from other alternatives?

<!----------------------------slide boundary--------------------------------->
# Cleaning and importing data
<!----------------------------slide boundary--------------------------------->
## Digging in | Prepping your data for R and vegan

### “The purpose of computing is insight, not numbers” 
### - Richard Hamming 

<!----------------------------slide boundary--------------------------------->
## Digging in | Prepping your data for R and vegan

### “The purpose of computing is insight, not numbers” 
### - Richard Hamming 
<br /><br /><br />
But you have to get through the numbers to get to the insight...

<!----------------------------slide boundary--------------------------------->
## Digging in | Prepping your data for R and vegan

We've all heard data horror stories
![](img/otherpeoplesdata.png)

<!----------------------------slide boundary--------------------------------->
## Cleaning your data for R and vegan

Cleaning spreadsheet example  

<!----------------------------slide boundary--------------------------------->
## Cleaning your data for R and vegan

Cleaning spreadsheet example
<br /><br />
Then...  
```{r, eval=FALSE}
setwd("your/working/directory/data")
varespec.csv.in <- read.csv("varespec.csv", header = TRUE, row.names = 1)
```


<!----------------------------slide boundary--------------------------------->
## Cleaning your data for R and vegan

* We will use some of vegan's built-in datasets for species `varespec` and environmental variables `varechem`
    * from Väre, H., Ohtonen, R. and Oksanen, J. (1995)

```{r, results='hide'}
library("vegan")
data(varespec)
data(varechem)
```

<!----------------------------slide boundary--------------------------------->
## Cleaning your data for R and vegan

* We will use built-in datasets for species `varespec` and environmental variables `varechem`
    * from: Väre, H., Ohtonen, R. and Oksanen, J. (1995)

```{r, results='hide'}
library("vegan")
data(varespec)
data(varechem)
```

```{r}
head(varespec[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
# Basic data summarizing
<!----------------------------slide boundary--------------------------------->
## Summarizing data with `apply()` | sums and sorting

**Sum of rows**
```{r}
sum.of.rows <- apply(varespec, 1, sum)
sort(sum.of.rows, decreasing = TRUE)[1:8] #top 8 rows (sites) 
```

<!----------------------------slide boundary--------------------------------->
## Summarizing data with `apply()` | sums and sorting

**Sum of rows**
```{r}
sum.of.rows <- apply(varespec, 1, sum)
sort(sum.of.rows, decreasing = TRUE)[1:8] #top 8 rows (sites) 
```
**Sum of columns**
```{r}
sum.of.columns <- apply(varespec, 2, sum)
sort(sum.of.columns, decreasing = TRUE)[1:8] #top 8 columns (species)
```

<!----------------------------slide boundary--------------------------------->
## Summarizing data with `apply()` | sums and sorting

**Number of plots in which each spp. occurs**
```{r}
spec.pres <- apply(varespec > 0, 2, sum) 
sort(spec.pres, decreasing = TRUE)[1:18]
```

<!----------------------------slide boundary--------------------------------->
# Data Transformation
<!----------------------------slide boundary--------------------------------->
## Basic data transformation

**Square root transformation**
```{r}
head(varespec[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Basic data transformation

**Square root transformation**
```{r}
head(varespec[,1:8], n = 3)
spec.sqrt <- sqrt(varespec)
head(spec.sqrt[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Total**
```{r}
head(varespec[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Total**
```{r}
head(varespec[,1:8], n = 3)
spec.total <- decostand(varespec, method = "total", MARGIN = 1) # by rows (sites)
head(spec.total[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Maximum**
```{r}
head(varespec[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Maximum** 
```{r}
head(varespec[,1:8], n = 3)
spec.max <- decostand(varespec, method = "max", MARGIN = 2) # by columns (species)
head(spec.max[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Presence-Absence**
```{r}
head(varespec[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Presence-Absence**
```{r}
head(varespec[,1:8], n = 3)
spec.pa <- decostand(varespec, method = "pa")
head(spec.pa[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Hellinger (Legendre & Gallagher 2001)**
Square root of method "total"
```{r}
head(varespec[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Hellinger (Legendre & Gallagher 2001)**
Square root of method "total"
```{r}
head(varespec[,1:8], n = 3)
spec.hellinger <- decostand(varespec, method = "hellinger", MARGIN = 1) # on rows (sites)
head(spec.hellinger[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Wisconsin double standardization**  
Shortcut function for standardizing species to maximum, then sites by totals.  
```{r}
head(varespec[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->
## Data transformation in vegan with `decostand()`

**Wisconsin double standardization**  
Shortcut function for standardizing species to maximum, then sites by totals.
```{r}
head(varespec[,1:8], n = 3)
spec.wisc <- wisconsin(varespec)
head(spec.wisc[,1:8], n = 3)
```

<!----------------------------slide boundary--------------------------------->

## Calculating distances with `vegdist()` | so many distance metrics, so little time!

How to choose a good one for your data set?  
First step, read the help for vegdist
```{r}
?vegdist
```

<!----------------------------slide boundary--------------------------------->

## Calculating distances with `vegdist()` | so many distance metrics, so little time!

Second, try `rankindex()`    

Higher rank correlations indicate better separation along a environmental gradients
```{r}
rank.all <- rankindex(varechem, varespec, indices = 
              c("bray", "euclid", "manhattan", "horn"), method = "spearman")
rank.all
```

<!----------------------------slide boundary--------------------------------->

## Calculating distances with `vegdist()` | so many distance metrics, so little time!

Second, try `rankindex()`    

Or across a single, selected gradient
```{r}
rank.Ca <- rankindex(varechem$Ca, varespec, indices = 
              c("bray", "euclid", "manhattan", "horn"), method = "spearman")
rank.Ca
```

<!----------------------------slide boundary--------------------------------->

## Calculating distances with `vegdist()` | so many distance metrics, so little time!

Second, try `rankindex()`    

Can also use on standardized data
```{r}
rank.wisc <- rankindex(varechem$Ca, wisconsin(varespec), indices = 
              c("bray", "euclid", "manhattan", "horn"), method = "spearman")
rank.wisc
```

<!----------------------------slide boundary--------------------------------->

## Calculating distances with `vegdist()` | comparison

```{r}
sort(rank.all, decreasing = TRUE)
sort(rank.Ca, decreasing = TRUE)
sort(rank.wisc, decreasing = TRUE)
```

<!----------------------------slide boundary--------------------------------->

## Rarefaction

## Within vs between group similarities

* `betadisper()`

## References
